# RegistrationWithSMSVerification

**RegistrationWithSMSVerification** - это проект, предназначенный для регистрации пользователей с подтверждением номера мобильного телефона через сервис SMS-рассылки.

## Особенности

- **Интеграция API сервиса SMS-рассылки:** Беспрепятственная интеграция с API сервиса SMS для отправки кодов подтверждения, что обеспечивает подлинность указанного при регистрации номера телефона.

- **Пошаговая регистрация:** Предлагает удобный процесс регистрации пошагово. Пользователи могут возобновить регистрацию на любом этапе, повторно подтвердив свой номер телефона, что делает процесс гибким и удобным.

- **Повышенная безопасность с использованием JWT:** Реализация JSON Web Tokens (JWT) для безопасной передачи данных. Этот метод не только обеспечивает целостность данных, но также помогает в эффективном управлении пользовательскими сессиями и аутентификации.

- **Контроль доступа на основе ролей:** Использование различных ролей пользователей для разграничения клиентов с неподтвержденными и подтвержденными номерами телефонов, повышая тем самым безопасность системы и управление пользователями.

## Управление JWT токенами

В проекте **RegistrationWithSMSVerification** используются JSON Web Tokens (JWT) для аутентификации и контроля доступа. JWT предоставляют различные уровни доступа в зависимости от статуса регистрации и подтверждения пользователя. Вот три основных типа JWT, используемых в системе:

### 1. JWT для незарегистрированных пользователей с неподтверждённым номером телефона
- **Описание:** Этот тип токена выдается пользователям, которые начали процесс регистрации, но ещё не подтвердили свой номер телефона.
- **Доступ:** Ограниченный доступ, позволяет только подтвердить номер телефона.

### 2. JWT для незарегистрированных пользователей с подтверждённым номером телефона
- **Описание:** Выдается после успешного подтверждения номера телефона, но до завершения всего процесса регистрации.
- **Доступ:** Расширенный доступ, позволяющий продолжить процесс регистрации, включая установку дополнительной информации и пароля.

### 3. JWT для зарегистрированных пользователей
- **Описание:** Предоставляется после завершения процесса регистрации и подтверждения всех необходимых данных.
- **Доступ:** Полный доступ, включая функциональность, специфичную для роли пользователя (например, администратор, клиент и т.д.).

## Стек Технологий

- **Spring Boot (2.7.16):**
- **Java (версия 17):**
- **PostgreSQL (версия 42.5.2):**
- **Spring Data JPA:** Упрощает работу с базами данных, обеспечивая интеграцию с Java Persistence API.
- **Spring Security:** Обеспечивает безопасность приложения, включая аутентификацию и авторизацию.
- **Flyway:** Инструмент для версионирования баз данных и управления миграциями.
- **Lombok:** Утилита для автоматизации написания шаблонного кода в Java.
- **Spring Boot Test и Spring Security Test:** Пакеты для тестирования Spring-приложений.
- **JSON Web Token (JWT) (версия 0.11.5):** Для безопасной передачи данных между клиентом и сервером.
- **JAXB API (версия 2.3.1):** Используется для преобразования объектов Java в XML и обратно.

## Эндпоинты API

### 1. Установка номера телефона
- **Метод:** POST
- **URL:** `/phone`
- **Требования:** Только для анонимных пользователей. Ожидается строка с номер телефона без символов.
- **Ответ:** Токен JWT (с неподтвержденным номером телефона) в случае успеха. 

### 2. Подтверждение телефона и пароля
- **Метод:** POST
- **URL:** `/confirmPhonePassword`
- **Требования:** Роль пользователя 'UNREGISTERED', код подтверждения и пароль.
- **Ответ:** Токен JWT (с подтвержденным номером телефона) при успешном подтверждении.

### 3. Установка дополнительной информации
- **Метод:** POST
- **URL:** `/setAdditional`
- **Требования:** Роль пользователя 'UNREGISTERED', дополнительная информация пользователя.
- **Ответ:** Статус успеха операции.

### 4. Установка пароля
- **Метод:** POST
- **URL:** `/setPassword`
- **Требования:** Роль пользователя 'UNREGISTERED', пароль.
- **Ответ:** Токен JWT (клиентский) в случае успешной установки пароля.

### 5. Вход в систему
- **Метод:** GET
- **URL:** `/login`
- **Требования:** Необходимо предоставить данные для входа.
- **Параметры запроса:** `LoginDto` (содержит логин и пароль).
- **Ответ:** `ResponseData<JwtDto>` содержащий JWT токен в случае успешного входа.

### 6. Обновление токена
- **Метод:** GET
- **URL:** `/refresh`
- **Требования:** Необходимо предоставить действующий refresh токен.
- **Параметры запроса:** `RefreshTokenDto` (содержит refresh токен).
- **Ответ:** `ResponseData<JwtDto>` содержащий новый JWT токен в случае успешного обновления.

